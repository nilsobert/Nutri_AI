% Header: Here are all packages used and some additional definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt,a4paper]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage[onehalfspacing]{setspace}
\usepackage{graphicx} % zum Einbinden von Graphiken
\usepackage[breaklinks=true,colorlinks=true,linkcolor=blue,urlcolor=blue,citecolor=blue]{hyperref} % f. Referenzen
\usepackage{listings} % for code
\usepackage{amsmath,amsthm,amssymb} % Mathematik Umgebung 
\usepackage{icomma} % Intelligentes Komma, das den richtigen Abstand zwischen Dezimalzahlen als auch in Formeln wählt.
\usepackage[most]{tcolorbox}
\tcbset{promptstyle/.style={enhanced, boxrule=0.5pt, arc=2pt, fonttitle=\bfseries\sffamily\small, left=8pt, right=8pt, top=8pt, bottom=8pt}}
\usepackage[english]{babel} % Deutsche Bezeichnungen bei Inhaltsangabe etc
\usepackage[T1]{fontenc}    % andere Schriftsatzkodierung für richtige Silbentrennung bei Umlauten
\usepackage[locale = US, space-before-unit=true, per-mode=symbol]{siunitx} % Bessere Einheiten
\usepackage{placeins} % Definiert den Befehl “\FloatBarrier”, der die Ausgabe der davor eingebundenen Bilder erzwingt, befor der Text weiter geht. (Mit vorsicht zu verwenden)
% \usepackage[natbib,abbreviate=true,doi=false,style=numeric-comp,giveninits=true,sorting=none]{biblatex} % Modernes Paket zur Erzeugung von Bibliografien (benötigt biber!)
\usepackage[backend=biber]{biblatex}
\usepackage{svg}
\usepackage{amsmath} % usually needed if your SVG has text
\usepackage[utf8]{inputenc}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{caption}
\usepackage{pdflscape} % Key package for single-page landscape

\usepackage{xcolor}

% prompt stuff:
% Configuration for the JSON/Code blocks
\lstset{
    basicstyle=\ttfamily\scriptsize,
    breaklines=true,
    breakatwhitespace=true,
    columns=fullflexible,
    keepspaces=true,
    showstringspaces=false,
    literate={’}{{'}}1 {“}{{"}}1 {”}{{"}}1 % Fixes the UTF-8 Quote errors
}

% Reusable prompt style
\tcbset{
    promptstyle/.style={
        enhanced,
        boxrule=0.8pt,
        arc=3pt,
        fonttitle=\bfseries\sffamily\small,
        left=8pt, right=8pt, top=10pt, bottom=10pt,
        shadow={1mm}{-1mm}{0mm}{black!10}
    }
}


% for prompt diagram
% --- Design for the UI Boxes ---
\tcbset{
    promptstyle/.style={
        enhanced,
        boxrule=0.5pt,
        arc=2pt,
        fonttitle=\bfseries\sffamily\small,
        upper box=normal,
        left=8pt, right=8pt, top=8pt, bottom=8pt,
        toptitle=3pt, bottomtitle=3pt
    }
}

% Color definitions for better styling
\definecolor{barblue}{RGB}{51, 102, 204}
\definecolor{groupblue}{RGB}{51, 102, 204}
\definecolor{linkred}{RGB}{165, 0, 33}


\addbibresource{MyBibliography.bib} % Ort der .bib Datei, die die Datenbank für Literatur/Referenzen enthält.

\graphicspath{{Images/}}

\DeclareSIUnit{\dBm}{dBm}
\DeclareSIUnit[per-mode=reciprocal]\WN{\per\centi\meter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%
\title{\includegraphics[width=3.5cm]{logo.png} \\ \vspace{1cm} \textbf{Project Management Report}}
\author{Laura Kotalczyk \\ Manuel Mühlberger \\ Joana Silva \\ Eduardo Pinto \\ Nils Harrer \\ \\ \textbf{Group 4}}
\date{\today}
\maketitle
\vfill
\newpage
%
%
% \tableofcontents
\thispagestyle{empty}
\cleardoublepage
\pagenumbering{arabic} 
\newpage
%
%
\section{Project Vision and Scope}
\label{sec:project_vision}
%
\noindent
The vision of this project is to develop a more accurate and user-friendly mobile application for tracking daily nutritional intake by combining visual and spoken input through AI, addressing the common pain points of current calorie-tracking tools, such as time-consuming manual entry, limited context in meal logging as well as calorie underestimation by existing AI-enabled calorie trackers.

\noindent
Many users struggle to track self-cooked meals, mixed dishes, or food eaten outside the home (e.g., at restaurants or similar), because existing apps require users to manually search, estimate, or break down 
ingredients. Nowadays, some apps do leverage AI-enabled image recognition to streamline calorie tracking, promising greater ease and speed, however, these tools often fall short in accuracy, frequently over- or underestimating actual calorie count, which ultimately undermines the reliability of even the most convenient logging methods.
\\
To address this gap, our app introduces an additional input to the AI-enabled estimation approach: by simply taking a photo of a meal and adding a brief voice description, such as “pancakes with milk, no sugar, 3 eggs, 2 cups of flour, topped with some maple syrup”, users can instantly generate a more accurate estimate of calories and nutrients. By expanding the vision modality with contextual natural language input, the app harnesses modern AI technologies to deliver not just convenience, but more accurate, data-driven insights.
The goal is to reduce user effort and improve accuracy through its multi-modal approach, particularly for home-cooked and complex meals that are frequently misclassified or under-estimated in existing tools. The user can also browse a simple calendar view to display daily food intake and progress towards goals. Insights are provided to the user as well, so he can gain information on metrics such as average meal quality, longest logging streaks and many others.
\\
This solution aims to make nutrition tracking simpler, smarter, and more accessible, helping users stay aware of their intake and make informed choices, without requiring expertise meticulous manual logging.

\subsection{Key Deliverables and Defined Boundaries}

\subsubsection{Key Deliverables}

\noindent
\begin{minipage}{\textwidth}
    \centering
    \label{tab:deliverables}
    \small
    \begin{tabularx}{\textwidth}{l X}
        \toprule
        \textbf{Deliverable} & \textbf{Description} \\
        \midrule
        Mobile App Prototype & A basic app (Android/iOS) that lets users: take a photo of a meal and record a voice note (e.g., "pancakes with milk, no sugar, 3 eggs"). \\
        \addlinespace[10pt]
        Voice-to-Text Feature & The app automatically turns the voice description into text using an AI audio transcription model such as Whisper. \\
        \addlinespace[10pt]
        AI Nutrient Analyzer & Uses a Vision Language Model (VLM) (e.g., GPT-4V or Qwen-VL) to analyze the photo and text, and returns estimated calories and nutrients (e.g., "250 kcal, 12g protein"). \\
        \addlinespace[10pt]
        Central Server & Self-hosted Server taking care of input processing, forwarding, user authentication and data storage.  \\
        \addlinespace[10pt]
        Simple Dashboard & Shows daily calorie and nutrient intake in a calendar view. \\
        \addlinespace[10pt]
        Test Data \& Results & Uses 10–20 real example meals (e.g., homemade pancakes, homemade spaghetti Bolognese) with known nutrition values to test how accurate the app is. \\
        \addlinespace[10pt]
        Benchmarking Results & Uses the ground-truth real example meals for benchmarking the prototype against other competitor apps, evaluating its accuracy in estimation of nutrients and calories. \\
        \addlinespace[10pt]
        Project Report & A written report illustrating the design and functioning of the app, test results, and lessons learned from the project, in particular referring to the use of GenAI. \\
        \bottomrule
    \end{tabularx}
    \captionof{table}{Project Key Deliverables}

\end{minipage}

\subsubsection{Project Boundaries}
To keep the project focused and manageable, we decided on the following project boundaries as well as mandatory and optional app features.
\newline

\noindent
\textbf{In Scope}
\begin{itemize}
    \item User can record one photo and voice note per meal
    \item Use of open-source AI models for voice transcription and nutrient estimation (e.g., OpenAI API, Hugging Face, available ones on GitHub)
    \item Output includes estimated calories and macronutrients (carbs, protein, fat)
    \item Simple, modern and intuitive user interface
    \item Testing using 10–20 example meals with known nutritional values (manually calculated)
    \item User has the possibility to see real-time insights considering his meal tracking activities
\end{itemize}

\newpage
\noindent
\textbf{Out of Scope}
\begin{itemize}
    \item Support for multiple languages or complex dishes with many unknown ingredients
    \item Integration with wearables or fitness trackers
    \item Integration of a user's training activities to increase available calories
    \item Nutrient database integration for more accurate results
    \item Possibility for data import/export
    \item Universally trusted server certificate
\end{itemize}

\section{Project Timeline \& Milestones}
\begin{figure}[h]
    \centering
    \includesvg[width=0.9\textwidth]{gantt.svg}
    \caption{Project Timeline and Milestones}
\end{figure}

\section{System Architecture and Technical Design}

\subsection{High-Level System Design}
\noindent
With respect to system design, we decided on a server-client architecture, involving two locally hosted servers and one externally hosted proxy server.
First and foremost, the NutriAI server (1) serves as the central communication hub, orchestrating all internal and external data flows. It manages and routes interactions between clients, the database, and external APIs, handling critical functions such as user sign-up, authentication, rate limiting, and database operations, ensuring seamless and secure system performance. \\
Secondly, server two (2) runs a reimplementation of OpenAI's Whisper model \cite{whisper}, that is used for transcribing a user's recorded voice note in the AI-assisted meal logging workflow. \\ Thirdly, the proxy server (3) handles the connectivity between the server and the clients. It acts as a load balancer \cite{pangolin, traefik} and a firewall that blocks malicious actors from reaching the server \cite{pangolin, crowdsec}. The client connects to the server domain, which points to the proxy server, forwarding all requests to the main NutriAI server. A more in-depth technical explanation is given in chapter \ref{chap:3.2}.

\begin{figure}[htbp]
    \centering
    \includesvg[width=0.9\textwidth]{system_design.svg}
    \caption{High-Level System Architecture of NutriAI}
    \label{fig:system_design}
\end{figure}

\noindent
By hosting all user data on our own locally managed server, we eliminate reliance on external service providers for storing sensitive information, allowing us to maintain a better control over the data. Furthermore, our locally hosted implementation of OpenAI’s Whisper model ensures that user voice data is never shared with external systems or used for AI training. Instead, audio recordings are securely processed within our private infrastructure, and only the resulting transcription, paired with the user’s meal photo, is sent to the externally hosted VLM. A more detailed explanation on data privacy and possible improvements in this regard for our service is given in the Project Safety and Reflection Report.

\subsection{Core Technical Components}
\label{chap:3.2}
In the following paragraphs, we will elaborate on each of our system's components from a technical perspective, pointing out its role and interactions in the overall system.

\subsubsection{Client}
\noindent
Since we were aiming at building a mobile app that runs cross-platform, we opted for Expo (version 54), after some research on possible options. Expo is a full-stack React Native framework that offers a rich ecosystem of pre-built components and tools, known for its simple setup, fast prototyping, and smooth development workflow \cite{expo}. Its accessibility made it a strong fit for our team, particularly given the varying levels of experience among team members. Thus, the client can either be an iOS or Android user. In the current development build, the app requires the user to have a custom certificate installed on their device, for encrypted communication with the NutriAI server. This limitation is due to time constraints, and for a production build it would be possible to host a universally trusted Let's Encrypt certificate on the server \cite{lets}.\\
The client does not manage a conventional database itself, but rather only has a minimal key-value store (react-native-async-storage) \cite{async} functioning as a caching layer. Here, frequently accessed data like the user profile, recent meal data (pictures, nutrients), etc. are stored. This enables the app to have a partially functional offline mode, where the user can still interact, although with limited functionality. 

\subsubsection{Proxy}
When the user uses the app to sign up, login or log a meal, corresponding requests are sent to the proxy server.
 This server is hosted as a docker stack on a Virtual Private Server (VPS) supplied by a Cloud Provider (Hetzner). It comprises of two main parts: Traefik and CrowdSec and the main Pangolin server. \\
 The NutriAI domain points directly to Traefik, which acts as the initial entry point for all incoming application traffic on the VPS. Traefik serves as a reverse proxy and load balancer, utilizing a specific middleware integration with CrowdSec to identify and block malicious requests before they reach the backend.
 Pangolin manages the "allowed" request flow by utilizing Newt, a user-space WireGuard tunnel client, to securely forward traffic to the on-premise server. This distributed architecture shields the internal infrastructure from malicious actors by punching through NAT and firewall restrictions without requiring open inbound ports. Furthermore, this setup facilitates high availability and failover, as a single Pangolin instance can coordinate and route traffic across multiple Newt site connectors.


\subsubsection{Server}
The On-Premise Server operates as a composed Docker stack on a shared Docker network, consisting of three primary components: the Newt connector, the Whisper transcription service, and the main NutriAI executable. As detailed in the Proxy section, the Newt container maintains the secure WireGuard tunnel, receiving forwarded requests from the upstream Pangolin instance and returning Nutri AI server responses. For voice processing, the system utilizes faster-whisper; however, to mitigate the lack of security in the stock container, a custom wrapper was implemented to handle authentication via API keys.
\\
The core NutriAI server handles the main application logic, utilizing the aforementioned custom SSL certificate for encrypted communication to the clients and an SQLite database for persistent storage. User credentials are secured using bcrypt to salt and hash passwords, and successful login or sign-up events issue a JSON Web Token (JWT) to authenticate subsequent requests. When processing a meal log, the server forwards the audio (.wav) file internally to Whisper, then combines the resulting transcription with the user’s image and a system prompt to send to an external OpenAI-compatible VLM endpoint. This design enables flexibility in model selection. While locally hosting the VLM would be an ideal feature to keep all data on-premise and the open source selection of VLM's is great, hardware constraints necessitated an external solution for this project. The server parses the VLM's structured JSON response — containing the meal name, description, and nutritional info — and stores it alongside the media in the database for the client to retrieve.

\section{Methodology}

\subsection{Project Management}
To organize our team and the development process of the mobile application properly, we decided on a ''SCRUM-alike'' agile work mode. We proceeded in increments of one-week long sprints, agreeing on tasks each of the team members should finish until the next week. During our weekly meeting slot in person, we then met to discuss our progress on the respective tasks, next steps and potential impediments. Apart from that we added new items and bug fix tickets to the product backlog, prioritized the product backlog and assigned tasks with respective deadlines to team members.
\begin{figure}[h]
    \begin{center}
    \includegraphics[width=0.8\textwidth]{trello.png}
    \caption{Project Management Board used for Development of NutriAI}
    \label{fig:trello}
    \end{center}
\end{figure}

\noindent
To keep track of the tickets and overall tasks concerning our project, we used Trello a project management tool that uses a flexible, Kanban-style system of boards, lists, and cards to help individuals and teams organize tasks, workflows, and ideas, making it easy to track progress from "to-do" to "done" \cite{trello}. For a screenshot taken from our project's board, refer to Figure \ref{fig:trello}.
Apart from using a project management tool, we also created a WhatsApp group with all the team members to agree on meeting dates, keep us updated and discuss immediate questions or provide advice quicklier.

\subsection{System Design}


\subsection{Database Design}

\subsection{Prompt Engineering}
During the development process, we applied various prompt engineering techniques to evaluate and compare two distinct prompt sets - one simpler and one more complex. The prompt set includes the system and user prompt. 
For the first prompt set, we devised a straightforward task description, providing the model with minimal context. This included a basic ruleset and an example JSON template to guide the model’s output, specifically designed for our desired meal analyzer use case. \\
\noindent
For the second prompt set, we utilized various prompt engineering techniques presented in the lecture.
Adopting a meta-prompting approach, we used Google’s Gemini 3 Flash Preview model to generate a suitable prompt for our use case. We began by providing it with a foundational context for the task, then explicitly instructed it to adopt the persona of a prompt engineer. We asked it to analyze the requirements and clearly articulate exactly what information it needed to craft an effective, targeted, and well-structured prompt. In addition, we instructed the model to request further context or clarification if any ambiguity or imprecision remained, and to explicitly signal when the prompt had reached a sufficiently accurate state, ensuring we could collaboratively finalize it confidently. Following our initial prompt, the model requested clarification, particularly regarding which input to prioritize in cases of ambiguity between image and text/transcription. After addressing these unclear aspects, we received a precise and sophisticated system prompt, along with a rather simple user prompt. We opted for a structured prompt, used delimiters to clearly indicate distinct parts of input and specifically stated our desired output format, a custom JSON. Additionally, during the development of prompt set two, we incorporated a full example, comprising an image and its corresponding transcription, to guide and inform prompt design. For both prompt sets, we also provided an example output to facilitate in-context learning.\\
\noindent
With these two versions, we now proceeded evaluating and comparing the performance of both prompt sets with different models and a set of ground truth meals\footnote{Ground truth meals are those for which we have both an image and complete nutritional data, enabling us to accurately assess and compare the performance of different prompt sets.}.
\\
\noindent
Against all expectations, the simpler prompt set performed much better in meal calorie and nutriant estimation than the second, more detailed prompt set.
Although both prompt sets, across all tested models, were overestimating calorie and nutriant values, prompt set one was still the more precise one of the two. Consequently, we kept prompt set one as our production-level prompt set.

- ggf. write that we adapted prompt s.t. fats are not as heavily overstimated anymore

- System Prompt: You are an expert nutrition assistant. Respond only with the requested JSON object
- Prompts anhaengen



\section{Team roles, responsibilities, and how collaboration was managed}
\begin{figure}[h]
    \centering 
    \includesvg[width=0.9\textwidth]{org_chart.svg}
    \caption{Team Chart}
\end{figure}
 

\section{Current Progress and Future Plans}
Progress Status and Roadmap to Completion
Current status (completed/in-progress/pending), key achievements, risks, and final steps

\section{Project Pitch Video (Attached)}

\section{Usage of GenAI during the Document's Creation}
\noindent
Generative AI was used during the writing process to help with brainstorming and organizing initial notes, and rephrasing passages.
It was also used to assist with debugging certain problems occuring with LaTeX.


\printbibliography

\end{document}
